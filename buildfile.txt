BUILD SUCCESSFUL

Total time: 10 mins 30.149 secs
Task timins:
  â€‹73354ms  :classpathChek
   â€‹7220ms  :validateListhubReference
    â€‹633ms  :cean
 â€‹182058ms  :compileJaa
   â€‹1744ms  :processResoures
  â€‹22872ms  :compileTestJaa
   â€‹2935ms  :processTestResouces
 â€‹330482ms  :test
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // retry
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // stage
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] libraryRe(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeline] archiveArt(ide)
ï¿¼Archiving artifacts
[Pipeli(ide)
ï¿¼+ rm /tmp/tmp.JPl2vbCkbA
[Pipeline](hide)
[Pipeline] { (Docker(hide)
[Pipeli(ide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pipeli(ide)
ï¿¼+ git rev-parse HEAD
[Pipeline] httpR(hide)
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.artifactoryDockerTagAndPush; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pipeline] newArtifactory(hide)
[Pipeline](hide)
[Pipel(hide)
[Pipeline] newBui(hide)
[Pipeline] dockerPu(hide)
expected to call org.jfrog.hudson.pipeline.common.types.Docker.push but wound up catching dockerPushStep; see: https://jenkins.io/redirect/pipeline-cps-method-mismathes/
ï¿¼Pushing image: docker.artifactory.moveaws.com/listhub/listhub:772e7bd
Could not find corresponding manifest.json file in Artifactory.
Could not find docker image: docker.artifactory.moveaws.com/listhub/listhub:772e7bd in Artifactory.
Successfully pushed docker image: docker.artifactory.moveaws.com/listhub/listhub:772e7bd
[Pipeline] }
[Pipeline] // retry
[Pipeline](hide)
[Pipel(hide)
[Pipeli(ide)
ï¿¼+ docker tag docker.artifactory.moveaws.com/listhub/listhub:772e7bd docker.artifactory.moveaws.com/listhub/listhub:latest
[Pipeline] }
[Pipeline] // retry
[Pipeline](hide)
[Pipel(hide)
[Pipeline] newBui(hide)
[Pipeline] dockerPu(hide)
expected to call org.jfrog.hudson.pipeline.common.types.Docker.push but wound up catching dockerPushStep; see: https://jenkins.io/redirect/pipeline-cps-method-mismathes/
ï¿¼Pushing image: docker.artifactory.moveaws.com/listhub/listhub:latest
Could not find corresponding manifest.json file in Artifactory.
Could not find docker image: docker.artifactory.moveaws.com/listhub/listhub:latest in Artifactory.
Successfully pushed docker image: docker.artifactory.moveaws.com/listhub/listhub:latest
[Pipeline] }
[Pipeline] // retry
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeli(ide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pipeli(ide)
ï¿¼+ git rev-parse HEAD
[Pipeline] httpR(hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] libraryRe(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeli(hide)
[Pipeline] archiveArt(ide)
ï¿¼Archiving artifacts
[Pipeli(ide)
ï¿¼+ rm /tmp/tmp.G2fQ0iPSQk
[Pipeline](hide)
[Pipeline] { (Docker(hide)
[Pipeli(ide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pipeli(ide)
ï¿¼+ git rev-parse HEAD
[Pipeline] httpR(hide)
[Pipeline] ans(hide)
[Pipel(hide)
[Pipeline(ide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline(ide)
ï¿¼ â€‹Skipping vulnerability scan. Not supported for JFrog Artifactory registry
[Pipeline] an (hide)
[Pipe (hide)
[Pipelin hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipel hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pipel hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] http (hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline] an (hide)
[Pipe (hide)
[Pipelin hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] libraryR (hide)
[Pipel (hide)
[Pipel (hide)
[Pipel (hide)
[Pipel (hide)
[Pipeline] archiveAr hide)
ï¿¼Archiving artifacts
[Pipel hide)
ï¿¼+ rm /tmp/tmp.VB1Pvgh9ny
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // node
[Pipeline] p (hide)
[Pipeline] { (Branch: bla (hide)
[Pipeline] { (Branch (hide)
[Pipelin (hide)
[Pipeline] p (hide)
[Pipeline] { (Branc (hide)
[Pipeline] { (Bran (hide)
[Pipelin hide)
ï¿¼Skipping dev build since devAccount is not set.
[Pipeline] }
[Pipelin hide)
ï¿¼Running on jenkins-slave-co7 (i-03bac934522239a04) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_aster
ï¿¼Skipping qa build since qaAccount is not set.
[Pipeline] }
[Pipe (hide)
[Pipeline] // parallel
[Pipelin hide)
ï¿¼Skipping int build since intEnvFileName is not set.
[Pipeline] c (hide)
[Pipelin hide)
ï¿¼Deploying environment: envVarPrefix=prod, args=[account:[accountId:104222541211, region:us-east-1, shortEnv:prod, yamlVariableFilename:aws-listhub-prod-us-east-1.yml, elbVariableFilename:elb-internet-facing.yml], accountShortEnv:prod, environmentType:trunk, ecsDeployType:blueGreen, ecsCanaryLifetimeTimeoutMins:5, ecsWeightedBlueGreenLifetimeTimeoutMins:5, ecsCleanupTimeoutMins:120, slackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@4a018177, githubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@73df8cf3, sendNotifications:[], envVarPrefix:prod, envNameSuffix:prod, envName:listhub-prod, envFileName:listhub-prod, devAccount:null, devCfInfrastructureProfile:dev, devCfForceApproveAfterXHours:null, devCfManuallyApproveChangeSetTimeoutHours:null, devCfSendNotificationOnManualApproval:false, devManuallyApproveDeployTimeoutHours:null, devEnvNameSuffix:dev, devEnvType:trunk, devStackMaxLifetimeHours:null, devSkipIfEnvFileNameNotSet:false, devEcsDeployType:blueGreen, devEcsCanaryLifetimeTimeoutMins:1, devEcsWeightedBlueGreenLifetimeTimeoutMins:1, devEcsCleanupTimeoutMins:1, devSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@326d4185, devGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@4d9e96c4, devSendNotifications:[], qaAccount:null, qaCfInfrastructureProfile:qa, qaCfForceApproveAfterXHours:null, qaCfManuallyApproveChangeSetTimeoutHours:null, qaCfSendNotificationOnManualApproval:false, qaManuallyApproveDeployTimeoutHours:null, qaEnvNameSuffix:qa, qaEnvType:trunk, qaStackMaxLifetimeHours:null, qaSkipIfEnvFileNameNotSet:false, qaEcsDeployType:blueGreen, qaEcsCanaryLifetimeTimeoutMins:1, qaEcsWeightedBlueGreenLifetimeTimeoutMins:1, qaEcsCleanupTimeoutMins:1, qaSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@1977df5a, qaGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@269c9c15, qaSendNotifications:[], prodAccount:[accountId:104222541211, region:us-east-1, shortEnv:prod, yamlVariableFilename:aws-listhub-prod-us-east-1.yml, elbVariableFilename:elb-internet-facing.yml], prodCfInfrastructureProfile:prod, prodCfForceApproveAfterXHours:null, prodCfManuallyApproveChangeSetTimeoutHours:8, prodCfSendNotificationOnManualApproval:false, prodManuallyApproveDeployTimeoutHours:null, prodEnvNameSuffix:prod, prodEnvType:trunk, prodStackMaxLifetimeHours:null, prodSkipIfEnvFileNameNotSet:false, prodEcsDeployType:blueGreen, prodEcsCanaryLifetimeTimeoutMins:5, prodEcsWeightedBlueGreenLifetimeTimeoutMins:5, prodEcsCleanupTimeoutMins:120, prodSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@4a018177, prodGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@73df8cf3, prodSendNotifications:[], intAccount:null, intCfInfrastructureProfile:null, intCfForceApproveAfterXHours:null, intCfManuallyApproveChangeSetTimeoutHours:null, intCfSendNotificationOnManualApproval:false, intManuallyApproveDeployTimeoutHours:2, intEnvNameSuffix:qa-int, intEnvType:int, intStackMaxLifetimeHours:null, intSkipIfEnvFileNameNotSet:true, intEcsDeployType:blueGreen, intEcsCanaryLifetimeTimeoutMins:1, intEcsWeightedBlueGreenLifetimeTimeoutMins:1, intEcsCleanupTimeoutMins:1, intSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@42891fd4, intGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@55970d36, intSendNotifications:[], prAccount:null, prCfInfrastructureProfile:null, prCfForceApproveAfterXHours:null, prCfManuallyApproveChangeSetTimeoutHours:null, prCfSendNotificationOnManualApproval:false, prManuallyApproveDeployTimeoutHours:null, prEnvNameSuffix:qa-pr, prEnvType:pr, prStackMaxLifetimeHours:8, prSkipIfEnvFileNameNotSet:false, prEcsDeployType:blueGreen, prEcsCanaryLifetimeTimeoutMins:1, prEcsWeightedBlueGreenLifetimeTimeoutMins:1, prEcsCleanupTimeoutMins:1, prSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@323a2319, prGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@1f5a11c1, prSendNotifications:[deletePipelineInput, deployFinish, deleteFinish], stagingAccount:null, stagingCfInfrastructureProfile:null, stagingCfForceApproveAfterXHours:null, stagingCfManuallyApproveChangeSetTimeoutHours:8, stagingCfSendNotificationOnManualApproval:false, stagingManuallyApproveDeployTimeoutHours:null, stagingEnvNameSuffix:qa-staging, stagingEnvType:staging, stagingStackMaxLifetimeHours:null, stagingSkipIfEnvFileNameNotSet:false, stagingEcsDeployType:blueGreenWithCanary, stagingEcsCanaryLifetimeTimeoutMins:5, stagingEcsWeightedBlueGreenLifetimeTimeoutMins:5, stagingEcsCleanupTimeoutMins:10, stagingSlackGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@6d24a1cf, stagingGithubGenerateMessage:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@5e2c4b8a, stagingSendNotifications:[], additionalInfrastructureTags:[], additionalVarsFiles:[deployment/vars.listhub-common.yml], allowConcurrentBuildsDuringInputForNewDeployment:true, appName:listhub, approvers:null, awsDeployToolsTag:latest, baseBranch:master, blackduckCopyPathsFromContainerToHostForScan:[[/app/listhub/build/, build/], [/usr/share/listhub/java/war, build/extracted-war]], blackduckEnabled:true, blackduckNoticesReport:true, blackduckPolicyCheck:false, blackduckPolicyCheckFailOnSeverities:Trivial,Minor,Major,Critical,Blocker, blackduckProjectDistribution:Internal, blackduckRiskReport:true, blackduckScanDockerImage:true, blueGreenTest:org.jenkinsci.plugins.workflow.cps.CpsClosure2@6fe438ca, branchingStrategy:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@4bb91e27, buildCommand:null, buildDockerContext:., buildDockerArgs:[GIT_SHA=$(git rev-parse --short HEAD), GIT_BRANCH=$BRANCH_NAME], buildDockerSkipImageExistCheck:false, buildDockerImage:listhub/listhub, bumpNpmPackageVersionOnConflict:true, cfInfrastructureTemplatePath:org.jenkinsci.plugins.workflow.cps.CpsClosure2@74db5559, cfnNagFailBuildOnViolation:false, cfnNagCustomRuleOrg:InnerOpenSource, cfnNagCustomRuleRepo:move-cfnnag-rules, cfnNagCustomRuleDir:custom-rules, cfnLintFailBuildOnViolation:true, checkmarxEnabled:false, checkmarxFailBuildOnNewResults:false, checkmarxIncrementalScan:true, checkmarxPreset:3, checkmarxProject:null, checkmarxWaitForScan:false, securityEnabled:true, securityWaitForResults:false, cloudformationDir:null, cloudformationEnvName:org.jenkinsci.plugins.workflow.cps.CpsClosure2@4af7a2af, cloudformationExtraYamlVars:[], containerAppPath:/app, containerRegistry:[getBuildinfo:org.jenkinsci.plugins.workflow.cps.CpsClosure2@2b9eb234, login:org.jenkinsci.plugins.workflow.cps.CpsClosure2@83c94f4, getDigest:org.jenkinsci.plugins.workflow.cps.CpsClosure2@23e7d910, imageExists:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@1b2f9eb6, build:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@5f1d51bc, vulnScan:org.jenkinsci.plugins.workflow.cps.CpsClosure2@52f8002b, tagAndPush:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@3d189399, run:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@13286823, runWithSts:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@38a8172, runAsCurrentUser:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@61c42f84, runAndCopyFiles:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@76aa7e2f, pull:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@6ef0d8a8, getImageSize:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@de7c0dd, getBuildExistingTags:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@8084553], deleteWorkspaceBeforeBuild:false, deleteWorkspaceAfterBuild:false, deployConfigDir:deployment, devBranch:master, directSlackNotification:null, ecsCluster:listhub-web-ecs-cluster, ecsClusterType:web, ecsServiceAlbOptions:[ecsBGCommonCFTemplate:ecs-service-bg-common.template, ecsServiceCFTemplate:ecs-service-alb-cloudformation.template, ecsServiceCanaryCfTemplate:ecs-service-canary.template, httpListenerExport:{{ ecsCluster }}-{{ accountAlbScheme }}-http-listener, httpsListenerExport:{{ ecsCluster }}-{{ accountAlbScheme }}-https-listener], featureBranchPrefix:feature/, gitUpdateStatus:true, jenkinsSlaveName:LINUXCO7, mainContainerName:listhub, mainContainerPort:8080, pipelineEventNotificationsEnabled:true, pipelineEventNotificationsEventsTopicArn:arn:aws:sns:us-west-2:860429940966:PipelineEvents, pipelineEventNotificationsAccountRegion:us-west-2, pipelineEventNotificationsAccountId:833973702035, pipelineProperties:[@disableConcurrentBuilds()], prPromptToDeleteStack:true, preBuildCallback:null, postBuildCallback:null, preDeleteCallback:null, postDeleteCallback:null, preDeployCallback:null, postCloudFormationCallback:null, postDeployCallback:null, postDeployCleanupCallback:null, prodBranch:master, prodBranchPrefix:null, qaBranch:master, s3MaxAge:60, shortShaLen:7, sproxyBucket:, slackChannel:listhub-status, stagingBranchPrefix:staging/, testDockerImage:org.jenkinsci.plugins.workflow.cps.CpsClosure2@5f508ae3, version:null, prDeployStack:true, disableScaledownAlarm:false, nrMonitorConfig:deployment/newrelic/monitors.yml, smokeTest:org.jenkinsci.plugins.workflow.cps.CpsClosure2@7a5388c5, branchDeployOverrides:[^feature/web-:[prEnvFileName:deployment/vars.listhub-pr.yml, prAccount:[accountId:104222541211, region:us-east-1, shortEnv:prod, yamlVariableFilename:aws-listhub-prod-us-east-1.yml, elbVariableFilename:elb-internal.yml]]], deployEnvironment:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@45ec2a0a, deleteEnvironment:org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure@418f4532, pipelineInstanceId:listhub-372-772e7bd, pipelineTimeStart:2020/12/01-22:03:49, buildStatus:started, envStateChangeLogger:org.jenkinsci.plugins.workflow.cps.CpsClosure2@709d4c44, buildinfo:[dockerBaseUrl:docker.artifactory.moveaws.com/listhub/listhub, dockerUrl:docker.artifactory.moveaws.com/listhub/listhub:772e7bd, dockerRepo:listhub/listhub, registryUrl:docker.artifactory.moveaws.com, version:772e7bd, context:., buildArgs:[GIT_SHA=$(git rev-parse --short HEAD), GIT_BRANCH=$BRANCH_NAME]], qaIntAccount:null, testEnvNamenull]
ï¿¼using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
[Pipelin hide)
ï¿¼Fetching changes from the remote Git repoitory
ï¿¼Running on jenkins-slave-co7 (i-03bac934522239a04) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master@2
[Pipe hide)
ï¿¼Fetching without tags
[Pipeline] c hide)
ï¿¼using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
Fetching changes from the remote Git repository
Fetching withouttags
 â€‹> git rev-parse --is-inside-work-tree # timeot=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/listhu.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key from mster
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/origin/aster
ï¿¼ â€‹> git rev-parse --is-inside-work-tree # timeut=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/listhb.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key from aster
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/origin/master
Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
Commit message: "fixed merge coflict"
ï¿¼Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
[Pipeline(hide)
ï¿¼ â€‹> git config core.sparsecheckout # timout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a2077bb4df28
[Pipeline] { (Blackdn (hide)
ï¿¼Commit message: "fixed merge conflict"
[Pipeline] or (hide)
[Pi { (hide)
[Pipelh (hide)
ï¿¼
[Pipeline] }
[Pipeline] // asiColor
ï¿¼ â€‹> git config core.sparsecheckout # tieout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a2077bb4df28
[Pi sh (hide)
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_new_relic_notify.template
[Pipeline] sts (hide)
[Pi h (hide)
ï¿¼Unable to find image 'docker.artifactory.moveaws.com/listhub/listhub:772e7bd' locally
772e7bd: Pulling from listhub/listhub
f22ccc0b8772: Pulling fs layer
3cf8fb62ba5f: Pulling fs layer
e80c964ece6a: Pulling fs layer
a375b6afd0bb: Pulling fs layer
ddd3d50a394c: Pulling fs layer
b92f7228b30b: Pulling fs layer
2d397bb0798c: Pulling fs layer
8e34b23e117e: Pulling fs layer
3e27c0edd997: Pulling fs layer
b92f7228b30b: Waiting
2d397bb0798c: Waiting
8e34b23e117e: Waiting
3e27c0edd997: Waiting
a375b6afd0bb: Waiting
ddd3d50a394c: Waiting
e80c964ece6a: Download complete
f22ccc0b8772: Download complete
3cf8fb62ba5f: Verifying Checksum
3cf8fb62ba5f: Download complete
ddd3d50a394c: Download complete
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼a375b6afd0bb: Verifying Checksum
a375b6afd0bb: Downloadcomplete
+ set +x
ï¿¼f22ccc0b8772: Pull complete
3cf8fb62ba5f: Pull complete
e80c964ece6a: Pullcomplete
ï¿¼+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼8e34b23e117e: Download complete
[Pi h (hide)
ï¿¼a375b6afd0bb: Pull complete
ddd3d50a394c: Pull complete
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼2d397bb0798c: Verifying Checksum
2d397bb0798c: Downloadcomplete
ï¿¼Skipping New Relic deployment notification since the newRelicAppId variable isnot set.
ï¿¼b92f7228b30b: Verifying Checksum
b92f7228b30b: Download complete
3e27c0edd997: Verifying Checksum
3e27c0edd997: Download complete
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_sns_send.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼Skipping SNS notification since a topic ARN is not configured.
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // node
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching movePipelineECS.deployEnvironment; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pipeco (hide)
ï¿¼Performing ECS deployment type blueGreen.
[Pipeoe (hide)
ï¿¼Running on jenkins-slave-co7 (i-03bac934522239a04) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master@2
[P] { (hide)
[Pipelineot (hide)
ï¿¼using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
Fetching changes from the remote Git repository
Fetching without tags
Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
Commit message: "fixed merge cnflict"
 â€‹> git rev-parse --is-inside-work-tree # tieout=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/lishub.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key fro master
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/origi/master
 â€‹> git config core.sparsecheckout # tieout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a2077bb4df28
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_ecs_blue_green_deploy_meta.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼b92f7228b30b: Pull complete
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ META=jenkins-deploy/.__ECS_BG_META_listhub-prod.yml
+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/ecs_blue_green_meta.py --ecs_cluster listhub-web-ecs-cluster --stack_name_prefix listhub-prod --active_alb_hostname1 app.listhub.moveaws.com --active_alb_hostname2 app.listhub.com --active_alb_hostname3 app.listhub.net --active_alb_hostname4 reports.listhub.com --active_alb_hostname5 reports.listhub.net --active_alb_hostname6 listings.listhub.com --active_alb_hostname7 listings.listhub.net --active_alb_hostname8 feeds.listhub.net --active_alb_hostname9 feeds.listhub.com --active_alb_hostname10 '' --inactive_alb_hostname1 i-app.listhub.moveaws.com --alb_priority_range_min 15001 --alb_priority_range_max 49999 --listener_exports listhub-web-ecs-cluster-internet-facing-http-listener listhub-web-ecs-cluster-internet-facing-https-listener --outfile jenkins-deploy/.__ECS_BG_META_listhub-prod.yml --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole --stack_min_containers_count 4 --can_optimize_pre_deployment ''
[38;21m2020-12-01 22:31:43,159 Found listener ARNs ['arn:aws:elasticloadbalancing:us-east-1:104222541211:listener/app/listh-Inter-1BUT2AQQQJ7E8/17b5fcd6770616ea/93da94ffc4dc8f68', 'arn:aws:elasticloadbalancing:us-east-1:104222541211:listener/app/listh-Inter-1BUT2AQQQJ7E8/17b5fcd6770616ea/1706bb5780f02e65']
[38;21m2020-12-01 22:31:43,939 Found existing ALB priorities {'17378', '49618', '43980', '26286', '28544', '39772', '20008', '25800', '31608', '16224', '18657', '41420', '42554', '48060', '20048', '38143', '31933'}
[38;21m2020-12-01 22:31:43,939 Allocated random ALB priority 23190 from range 15001-49999
[38;21m2020-12-01 22:31:44,128 Found existing ALB priorities {'17378', '23190', '49618', '43980', '26286', '28544', '39772', '20008', '25800', '31608', '16224', '18657', '41420', '42554', '48060', '20048', '38143', '31933'}
[38;21m2020-12-01 22:31:44,128 Allocated random ALB priority 26057 from range 15001-49999
[38;21m2020-12-01 22:31:44,317 Found existing ALB priorities {'43980', '26286', '18657', '20048', '38143', '31933', '17378', '28544', '16224', '49618', '23190', '20008', '31608', '39772', '25800', '26057', '41420', '48060', '42554'}
[38;21m2020-12-01 22:31:44,317 Allocated random ALB priority 49143 from range 15001-49999
[38;21m2020-12-01 22:31:44,502 Found existing ALB priorities {'43980', '26286', '18657', '20048', '38143', '31933', '17378', '28544', '16224', '49618', '23190', '20008', '31608', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:44,502 Allocated random ALB priority 30042 from range 15001-49999
[38;21m2020-12-01 22:31:44,694 Found existing ALB priorities {'43980', '26286', '18657', '20048', '38143', '31933', '17378', '28544', '16224', '49618', '23190', '30042', '20008', '31608', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:44,695 Allocated random ALB priority 28132 from range 15001-49999
[38;21m2020-12-01 22:31:44,916 Found existing ALB priorities {'43980', '26286', '18657', '20048', '38143', '31933', '17378', '28544', '16224', '49618', '23190', '30042', '20008', '31608', '28132', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:44,916 Allocated random ALB priority 33136 from range 15001-49999
[38;21m2020-12-01 22:31:45,103 Found existing ALB priorities {'43980', '26286', '18657', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '31608', '28132', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:45,103 Allocated random ALB priority 48277 from range 15001-49999
[38;21m2020-12-01 22:31:45,289 Found existing ALB priorities {'43980', '26286', '18657', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '31608', '28132', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:45,289 Allocated random ALB priority 17927 from range 1501-49999
ï¿¼2d397bb0798c: Pull complete
8e34b23e117e: Pullcomplete
ï¿¼[38;21m2020-12-01 22:31:45,585 Found existing ALB priorities {'43980', '26286', '18657', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '31608', '17927', '28132', '39772', '25800', '26057', '41420', '48060', '42554', '49143'}
[38;21m2020-12-01 22:31:45,585 Allocated random ALB priority 41607 from range 15001-49999
[38;21m2020-12-01 22:31:45,773 Found existing ALB priorities {'43980', '26286', '18657', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '31608', '49143', '17927', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:45,773 Allocated random ALB priority 16215 from range 15001-49999
[38;21m2020-12-01 22:31:45,959 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '49143', '31608', '17927', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:45,959 Allocated random ALB priority 29575 from range 15001-49999
[38;21m2020-12-01 22:31:46,142 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '49143', '31608', '17927', '29575', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:46,143 Allocated random ALB priority 24003 from range 15001-49999
[38;21m2020-12-01 22:31:46,333 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '49143', '31608', '24003', '17927', '29575', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:46,333 Allocated random ALB priority 21370 from range 15001-49999
[38;21m2020-12-01 22:31:46,520 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '49143', '31608', '24003', '17927', '29575', '21370', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:46,520 Allocated random ALB priority 44772 from range 15001-49999
[38;21m2020-12-01 22:31:46,751 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '20008', '49143', '31608', '24003', '44772', '17927', '29575', '21370', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:46,752 Allocated random ALB priority 15373 from range 15001-49999
[38;21m2020-12-01 22:31:46,934 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '15373', '20008', '49143', '31608', '24003', '44772', '17927', '29575', '21370', '28132', '39772', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:46,935 Allocated random ALB priority 34590 from range 15001-49999
[38;21m2020-12-01 22:31:47,122 Found existing ALB priorities {'43980', '26286', '18657', '16215', '48277', '20048', '38143', '31933', '17378', '28544', '16224', '33136', '49618', '23190', '30042', '15373', '20008', '49143', '31608', '24003', '44772', '17927', '29575', '21370', '28132', '39772', '34590', '25800', '26057', '41420', '48060', '41607', '42554', -1}
[38;21m2020-12-01 22:31:47,122 Allocated random ALB priority 29959 from range 15001-49999
2020-12-01 22:31:50,852 Deployment Metrics
{"cluster_name": "listhub-web-ecs-cluster", "service_name": "listhub-prod-green", "service_min_count": 4, "prev_desired_num": 4, "cluster_info": {"largest_container_cpu": 256, "instance_type": "m5.2xlarge", "largest_container_memory": 7168, "asg_name": "listhub-web-ecs-cluster-ECSAutoScalingGroup-1OT4REVQXS7AP"}, "asg_statistics": {"min_instance_count": 4, "max_instance_count": 12, "desired_instance_count": 4}, "cluster_stats": {"registered_container_instances_count": 4, "pending_tasks_count": 0, "running_tasks_count": 18}, "instance_type_info": {"memory": 32768, "vcpu": 8192}, "schedulable_containers": 10, "additional_containers_count": 0, "containers_per_ec2_instance": 4, "additional_ecs_instances_count": 0, "new_asg_desired_capacity": null}
+ chmod 0666 jenkins-deploy/.__ECS_BG_META_listhub-prod.yml
[Pipeline] }
[Pipeline] // ansiColor
[Pipelineile (hide)
[Pipeco (hide)
ï¿¼Reading ECS blue / green metadata
[activeAlbHostname=app.listhub.moveaws.com, activeAlbHostname2=app.listhub.com, activeAlbHostname3=app.listhub.net, activeAlbHostname4=reports.listhub.com, activeAlbHostname5=reports.listhub.net, activeAlbHostname6=listings.listhub.com, activeAlbHostname7=listings.listhub.net, activeAlbHostname8=feeds.listhub.net, activeAlbHostname9=feeds.listhub.com, activeAlbHostname10=, inactiveAlbHostname=i-app.listhub.moveaws.com, newDeployStackName=listhub-prod-blue, newDeployPriority=41607, newDeployPriority2=23190, newDeployPriority3=26057, newDeployPriority4=49143, newDeployPriority5=30042, newDeployPriority6=28132, newDeployPriority7=33136, newDeployPriority8=48277, newDeployPriority9=17927, newDeployPriority10=-1, prevDeployStackName=listhub-prod-green, prevDeployPriority=25800, prevDeployPriority2=31608, prevDeployPriority3=16224, prevDeployPriority4=39772, prevDeployPriority5=43980, prevDeployPriority6=42554, prevDeployPriority7=17378, prevDeployPriority8=28544, prevDeployPriority9=49618, prevDeployPriority10=-1, prevStackExists=1, prevDesiredCount=4]
[Pipelage (hide)
[Pipeline] { (prod Blue / Greon) (hide)
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_ecs_blue_green_deploy_phase1_common.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼3e27c0edd997: Pull complete
Digest: sha256:60e50cac36dede2ab1c546c0301713a8c465b995409ee393bd6c8633c4f2d694
Status: Downloaded newer image for docker.artifactory.moveaws.com/listhub/listhu:772e7bd
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/cf_simple_deploy.py --stack_name listhub-prod-bg-common --cf_template_path /usr/local/aws-deploy-tools/templates/ecs-service-bg-common.template --extra_tag Name=listhub-prod owner=sysadmin@listhub.com product=listhub component=app environment=prod --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole --variables_path /usr/local/aws-deploy-tools/variables/aws-globals.yml /usr/local/aws-deploy-tools/variables/aws-listhub-prod-us-east-1.yml /usr/local/aws-deploy-tools/variables/move-deprecated.yml jenkins-deploy/listhub-prod/env-vars.yml /usr/local/aws-deploy-tools/variables/elb-internet-facing.yml deployment/vars.listhub-common.yml deployment/vars.listhub-prod.yml
[38;21m2020-12-01 22:32:05,415 Rendered CloudFormation template:
Description: app.listhub.moveaws.com DNS entries.

Resurces:
  â€‹ns1:
    â€‹Type: AWS::Route53::RecordSetroup
    â€‹Propertis:
      â€‹HostedZoneId: "Z1WPQLJ0FIWUK"
      â€‹RecordSets
        â€‹- Name: "app.listhub.moveaws.com"
         â€‹Type: "A"
         â€‹AliasTarget:
           â€‹HostedZoneId:
             â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-hosted-zone-id"
           â€‹DNSName:
             â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facig-url"
  â€‹ns2:
    â€‹Type: AWS::Route53::RecordSetroup
    â€‹Propertis:
      â€‹HostedZoneId: "Z1WPQLJ0FIWUK"
      â€‹RecordSets
        â€‹- Name: "i-app.listhub.moveaws.com"
         â€‹Type: "A"
         â€‹AliasTarget:
           â€‹HostedZoneId:
             â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-hosted-zone-id"
           â€‹DNSName:
             â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-url"












[38;21m2020-12-01 22:32:05,415 Deploying stack listhub-prod-bg-common.
[38;21m2020-12-01 22:32:05,415 stack_params: []
[38;21m2020-12-01 22:32:18,806 Finished CF deployment in 0:00:16.432142.
INFO: Skipping Terminate Protect as flag is not set
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librarce (hide)
[Pi sh (hide)
[Pi h (hide)
ï¿¼12e3d9b3649c043663bf07bf440156aa679bf237dde39229393885b8853662e0
[Pi sh (hide)
[Pi sh (hide)
[Pi h (hide)
ï¿¼+ vault kv get --field=username kv/external-tools-secrets/blackduck
[Pi sh (hide)
[Pipeline] archivcs (hide)
ï¿¼Archiving artifacts
[Pi h (hide)
ï¿¼+ vault kv get --field=password kv/external-tools-secrets/lackduck
ï¿¼+ rm /tmp/tmp.qVbG4LNi4w
[Pi sh (hide)
[Pipelage (hide)
[Pipeline] { (prod Inactive Staoy) (hide)
[Pi h (hide)
ï¿¼+ git config remote.origin.url
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_ecs_blue_green_canary_delete.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeco (hide)
ï¿¼This function is DEPRECIATED.
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pipeco (hide)
ï¿¼Finished Blackduck scan.
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // stage
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librarce (hide)
[Pi sh (hide)
[Pi h (hide)
ï¿¼+ set +x
[Pi sh (hide)
[Pi h (hide)
ï¿¼+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pipeline] archivcs (hide)
ï¿¼Archiving artifacts
[Pi sh (hide)
[Pi h (hide)
ï¿¼+ rm /tmp/tmp.DUsEYGHhKy
[Pipeline] }
[Pipeline] // node
[Pipeline] }
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/cf_stack_delete.py --stack_name listhub-prod-canary --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole
[38;21m2020-12-01 22:32:37,113 Stack listhub-prod-canary does not exist.
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_ecs_blue_green_deploy_phase2_inactive_stack_deploy.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼++ mktemp
+ CF_TEMPLATE_PATH=/tmp/tmp.jnfieK
++ mktemp
+ CF_PARAMS=/tmp/tmp.MCAKKD
+ trap finish EXIT
+ cat
+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/create_ecs_service_cf_template.py --cloudformation_template /usr/local/aws-deploy-tools/templates/ecs-service-alb-cloudformation.template --deploy_config_dir deployment --output /tmp/tmp.jnfieK --variables_path /usr/local/aws-deploy-tools/variables/aws-globals.yml /usr/local/aws-deploy-tools/variables/aws-listhub-prod-us-east-1.yml /usr/local/aws-deploy-tools/variables/move-deprecated.yml jenkins-deploy/listhub-prod/env-vars.yml /usr/local/aws-deploy-tools/variables/elb-internet-facing.yml deployment/vars.listhub-common.yml deployment/vars.listhub-prod.yml
+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/cf_simple_deploy.py --stack_name listhub-prod-blue --cf_template_path /tmp/tmp.jnfieK --params_path /tmp/tmp.MCAKKD --remove_stack_if_broken --ecs_cluster listhub-web-ecs-cluster --ecs_service_name listhub-prod-blue --extra_tag Name=listhub-prod owner=sysadmin@listhub.com product=listhub component=app environment=prod --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole --variables_path /usr/local/aws-deploy-tools/variables/aws-globals.yml /usr/local/aws-deploy-tools/variables/aws-listhub-prod-us-east-1.yml /usr/local/aws-deploy-tools/variables/move-deprecated.yml jenkins-deploy/listhub-prod/env-vars.yml /usr/local/aws-deploy-tools/variables/elb-internet-facing.yml deployment/vars.listhub-common.yml deployment/vars.listhub-prod.yml
[38;21m2020-12-01 22:32:49,065 Rendered CloudFormation parameters:
ServiceName: "listhub-prod-blue"
Hostname: "i-app.listhub.moveaws.com"
AlbPriority: "41607"
HealthCheckIntervalSeconds: ""
HealthCheckTimeoutSeconds: ""

[38;21m2020-12-01 22:32:49,068 Rendered CloudFormation template:
# CloudFormation template for ECS blue / green deployments. This template uses Mustache (or one of
# its derivities, like Pystache) to inject the following values:
#
# - ecsCluster - The name of the ECS cluster to deploy the service into.
#
# - ecsDeployMaxPercent - Optional. The MaximumPercent field.
#                         https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-deploymentconfiguration.html
#
# - ecsDeployMinHealthyPercent - Optional. The MinimumHealthyPercent field.
#                                https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-deploymentconfiguration.html
#
# - ecsDistinctInstancePlacementConstraint - Optional. Whether or not to enable a distinctInstance
#                                            placement constraint.
#                                            https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-placementconstraints-placementconstraint.html
#
# -  ecsMemberOfPlacementConstraint - Optional. Cluster Query Language to contrain deployments.
#                                            https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-placementconstraint.html
# 
#
# - ecsSpreadAzPlacementStrategy - Optional. Whether or not to spread containers across AZs
#                                  as a placement strategy.
#                                  https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-placementstrategies-placementstrategy.html
#
# - ecsSpreadInstanceIdPlacementStrategy - Optional. Whether or not to spread containers across
#                                          instances as a placement strategy.
#                                          https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-placementstrategies-placementstrategy.html
#
# - ecsServiceScaleDownAdjustment
# - ecsServiceScaleDownCompOp
# - ecsServiceScaleDownEvalPeriods
# - ecsServiceScaleDownMetric
# - ecsServiceScaleDownNamespace
# - ecsServiceScaleDownStatistic
# - ecsServiceScaleDownThreshold
# - ecsServiceScaleUpAdjustment
# - ecsServiceScaleUpCompOp
# - ecsServiceScaleUpEvalPeriods
# - ecsServiceScaleUpMetric
# - ecsServiceScaleUpNamespace
# - ecsServiceScaleUpStatistic
# - ecsServiceScaleUpThreshold - Optional. Autoscaling properties for the
#                                AWS::ApplicationAutoScaling::ScalableTarget and
#                                AWS::ApplicationAutoScaling::ScalingPolicy.
#
# - envName  - The name of the ECS canary service. This is only used for the CloudFormation
#              template description.
#
# - healthCheckHttpCode - The expected HTTP status code from the health check endpoint.
#                         https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html
#
# - healthCheckUrl - The relative path of the health check URL.
#                         https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-targetgroup.html
#
# - httpListenerExport
# - httpsListenerExport - The ARN of the HTTP/HTTPS listeners on the ALB. This is typically the
#                         CloudFormation export ${ECS_CLUSTER}-${ALB_SCHEME}-http-listener,
#                         where ALB_SCHEME is either internal or internet_facing. See the
#                         ECS Cluster CloudFormation template in this repo for the export.
#                         https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-elasticloadbalancingv2-listener.html
#
# - iamRoleArn - Optional. An existing IAM role ARN that will be used as the ECS task role.
#                If you specify this, then do not specify iamTaskPolicy.
#
# - iamTaskPolicy - Optional. Create a new IAM role for the ECS task role. This is the policy
#                   document for the AWS::IAM::Role CloudFormation resource.
#
# - mainContainerName
# - mainContainerPort - The container name and container port that will receive traffic from the ALB
#                       https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-service-loadbalancers.html
#
# - minCapacity
# - maxCapacity - The min/max capacity for the ECS service application autoscaling group.
#                 https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-applicationautoscaling-scalabletarget.html
#
# - prevDesiredCount - The desired count for the ECS service. Typically, when we do a blue / green
#                      deployment, the deployment pipeline gets the desired count of
#
# - targetGroupDeregistrationDelay - The target group deregistration delay.
#                                    https://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_TargetGroupAttribute.html
#
# - targetGroupLbCookieDurationSecs
# - targetGroupStickinessEnabled - Whether or not session stickiness is enabled at the ALB and how
#                                  long the session tokens should live.
#                                  https://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_TargetGroupAttribute.html
#
# - taskDefinitionYaml - The AWS::ECS::TaskDefinition CloudFormation configuration. This is
#                        embedded within Move's projects in the deployment/Dockerrun.aws.yml
#                        file.
#                        https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ecs-taskdefinition.html


Description: listhub-prod ECS service.

Paraeters:
  â€‹Serviceame:
    â€‹Type: Sring
    â€‹Description: ECS servic name

  â€‹HealthCheckIntervalSecnds:
    â€‹Type: Sring
    â€‹Description: Seconds between healthcecks
    â€‹Defaut: 30

  â€‹HealthCheckTimeoutSecnds:
    â€‹Type: Sring
    â€‹Description: Seconds during which no response from a target means a failed healthheck
    â€‹Defalt: 5

  â€‹Hostame:
    â€‹Type: Sring
    â€‹Description: Hostname 1 for te ALB

  â€‹Hostnme2:
    â€‹Type: Sring
    â€‹Description: Optional hostname 2 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme3:
    â€‹Type: Sring
    â€‹Description: Optional hostname 3 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme4:
    â€‹Type: Sring
    â€‹Description: Optional hostname 4 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme5:
    â€‹Type: Sring
    â€‹Description: Optional hostname 5 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme6:
    â€‹Type: Sring
    â€‹Description: Optional hostname 6 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme7:
    â€‹Type: Sring
    â€‹Description: Optional hostname 7 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme8:
    â€‹Type: Sring
    â€‹Description: Optional hostname 8 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnme9:
    â€‹Type: Sring
    â€‹Description: Optional hostname 9 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹Hostnae10:
    â€‹Type: Sring
    â€‹Description: Optional hostname 10 for theALB.
    â€‹Default: "unused.intrnal"

  â€‹AlbPrioity:
    â€‹Type: Nmber
    â€‹Description: ALB prioity 1

  â€‹AlbPriorty2:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 2. Requires Hostname2 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty3:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 3. Requires Hostname3 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty4:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 4. Requires Hostname4 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty5:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 5. Requires Hostname5 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty6:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 6. Requires Hostname6 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty7:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 7. Requires Hostname7 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty8:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 8. Requires Hostname8 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPriorty9:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 9. Requires Hostname9 to not be mpty
    â€‹Defaut: -1

  â€‹AlbPrioriy10:
    â€‹Type: Nmber
    â€‹Description: Optional ALB priority 10. Requires Hostname10 to not be mpty
    â€‹Defaut: -1

  â€‹NewTargetGroupWeght:
    â€‹Type: Nmber
    â€‹Description: Weight for the new target roup
    â€‹MinVale: 0
    â€‹MaxValue 100
    â€‹Defaul: 100

  â€‹PrevTargetGroupWeght:
    â€‹Type: Nmber
    â€‹Description: Weight for the previous target roup
    â€‹MinVale: 0
    â€‹MaxValue 100
    â€‹Default: 0

Condtions:
  â€‹HasHostnme2:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame2 ]
  â€‹HasHostnme3:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame3 ]
  â€‹HasHostnme4:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame4 ]
  â€‹HasHostnme5:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame5 ]
  â€‹HasHostnme6:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame6 ]
  â€‹HasHostnme7:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame7 ]
  â€‹HasHostnme8:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame8 ]
  â€‹HasHostnme9:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostame9 ]
  â€‹HasHostnae10:
    â€‹Fn:Not:
    â€‹- !Equals [ "unused.internal", !Ref Hostnme10 ]
  â€‹WeightedBlueGreen: !Not [ !Equals [!Ref PrevTargetGroupWeight, 0] ]

Resurces:
  â€‹Serice:
    â€‹Type: AWS::ECS::Sevice
    â€‹Dependsn:
      â€‹- EcsServiceRle
      â€‹- HttpsListenerRle
      â€‹- TargetGrup
      â€‹- TasRole
    â€‹Propertis:
      â€‹ServiceName: !Ref ServiceNme
      â€‹Cluster: listhub-web-ecs-cluser
      â€‹Role: !Ref EcsServiceRle
      â€‹DesiredCount 4
      â€‹TaskDefinition: !Ref TaskDefiniton
      â€‹PlacementStrategies
        â€‹- Type: spread
         â€‹Field: attribute:ecs.availability-zon
        â€‹- Type: spread
         â€‹Field: instancId
      â€‹LoadBalancers
        â€‹- ContainerName: listhub
         â€‹ContainerPort: 8080
         â€‹TargetGroupArn: !Ref TargeGroup

  â€‹ServiceScalingTaget:
    â€‹Type: AWS::ApplicationAutoScaling::ScalableTrget
    â€‹DependsOn: Sevice
    â€‹Propertis:
      â€‹MinCapacity 4
      â€‹MaxCapacity 8
      â€‹ResourceId: !Join ['', [service/listhub-web-ecs-cluster, /, !GetAtt [Service, Name]]
      â€‹RoleARN: !GetAtt [AutoscalingRole, An]
      â€‹ScalableDimension: ecs:service:DesiredCont
      â€‹ServiceNamespac: ecs

  â€‹Autoscalingole:
    â€‹Type: AWS::IAM:Role
    â€‹Propertis:
      â€‹PermissionsBoundary: !Join ["", [ 'arn:aws:iam::', !Ref 'AWS::AccountId', ':policy/CloudServices-Boundary']]
      â€‹AssumeRolePolicyDocument
        â€‹Statement
        â€‹- Effect: Allow
         â€‹Principal:
           â€‹Service:
             â€‹- application-autoscaling.amazonaws.com
         â€‹Action:
           â€‹- sts:AssumeRle
      â€‹Path /
      â€‹ManagedPolicyArns
        â€‹- arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServiceAutoscaleRle
      â€‹Policies
        â€‹- PolicyName: service-autoscaling
         â€‹PolicyDocument:
           â€‹Version: "2012-10-17"
           â€‹Statement:
             â€‹- Effect: Allow
               â€‹Action:
                 â€‹- application-autoscaling:*
                 â€‹- cloudwatch:DescribeAlarms
                 â€‹- cloudwatch:PutMetricAlarm
               â€‹Resource:
                 - "*"

  â€‹ServiceScaleUpPoicy:
    â€‹Type: AWS::ApplicationAutoScaling::ScalingPlicy
    â€‹Propertis:
      â€‹PolicyName: !Sub ${AWS::StackName}-scale-up-polcy
      â€‹PolicyType: StepScalng
      â€‹ScalingTargetId: !Ref 'ServiceScalingTargt'
      â€‹StepScalingPolicyConfiguration
        â€‹AdjustmentType: ChangeInCapacit
        â€‹Cooldown: 30
        â€‹MetricAggregationType: Maximu
        â€‹StepAdjustments:
         â€‹- MetricIntervalLowerBound: 0
           â€‹ScalingAdjustmnt: 1

  â€‹ServiceScaleDownPoicy:
    â€‹Type: AWS::ApplicationAutoScaling::ScalingPlicy
    â€‹Propertis:
      â€‹PolicyName: !Sub ${AWS::StackName}-scale-down-polcy
      â€‹PolicyType: StepScalng
      â€‹ScalingTargetId: !Ref 'ServiceScalingTargt'
      â€‹StepScalingPolicyConfiguration
        â€‹AdjustmentType: ChangeInCapacit
        â€‹Cooldown: 30
        â€‹MetricAggregationType: Maximu
        â€‹StepAdjustments:
         â€‹- MetricIntervalUpperBound: 0
           â€‹ScalingAdjustmet: -1

  â€‹ScaeUp:
    â€‹Type: AWS::CloudWatch::larm
    â€‹Propertis:
      â€‹EvaluationPeriods: 5'
      â€‹Statistic: Averge
      â€‹AlarmDescription: Alarm if CPUUtilization is too hih.
      â€‹Period: '0'
      â€‹AlarmActions: [!Ref 'ServiceScaleUpPolic']
      â€‹Threshold: '5'
      â€‹ComparisonOperator: GreaterThanThreshld
      â€‹Namespace: AWS/CS
      â€‹Dimensions
        â€‹- Name: ClusterName
         â€‹Value: listhub-web-ecs-cluste
        â€‹- Name: ServiceName
         â€‹Value: !GetAtt [Service, Nae]
      â€‹MetricName: CPUUtiliation

  â€‹Scaleown:
    â€‹Type: AWS::CloudWatch::larm
    â€‹Propertis:
      â€‹EvaluationPeriods: '5'
      â€‹Statistic: Averge
      â€‹AlarmDescription: Alarm if CPUUtilization is too lw.
      â€‹Period: '0'
      â€‹AlarmActions: [!Ref 'ServiceScaleDownPolic']
      â€‹Threshold: '0'
      â€‹ComparisonOperator: LessThanThreshld
      â€‹Namespace: AWS/CS
      â€‹Dimensions
        â€‹- Name: ClusterName
         â€‹Value: listhub-web-ecs-cluste
        â€‹- Name: ServiceName
         â€‹Value: !GetAtt [Service, Nae]
      â€‹MetricName: CPUUtiliation

  â€‹TaskDefiniion:
    â€‹Type: AWS::ECS::TaskDefintion
    â€‹Propertis:
      â€‹TaskRoleArn: !Ref TaskRle
      â€‹ContainerDefinitios:
      â€‹- EntryPoint
        â€‹- start-webap
        â€‹Environment
        â€‹- Name: CANARY_DEPLOYMENT
         â€‹Value: 'false
        â€‹- Name: GIT_SHA
         â€‹Value: 772e7b
        â€‹- Name: GIT_BRANCH
         â€‹Value: maste
        â€‹- Name: BUILD_NUMBER
         â€‹Value: '372
        â€‹- Name: JOB_NAME
         â€‹Value: listhub-prod-772e7b
        â€‹- Name: profile
         â€‹Value: aws-us-east-1-production-we
        â€‹- Name: java_opts
         â€‹Value: -XX:MaxRAM=7168m -javaagent:/usr/share/listhub/java/resources/newrelic/newrelic.ja
        â€‹- Name: LH_MONITORING_NEWRELIC_APP_NAME
         â€‹Value: listhub (prod
        â€‹- Name: LH_MONITORING_NEWRELIC_LICENSE
         â€‹Value: 1db41a911da6aa096d827eea7fa11e00807dc58
        â€‹- Name: VAULT_ENV
         â€‹Value: pro
        â€‹- Name: VAULT_ROLE
         â€‹Value: industryplatforms-listhub-prod-ia
        â€‹- Name: VAULT_PREFIX
         â€‹Value: kv/industryplatforms/listhub/pro
        â€‹Essential: tru
        â€‹Image: docker.artifactory.moveaws.com/listhub/listhub:772e7b
        â€‹LinuxParameters:
         â€‹InitProcessEnabled: 'true
        â€‹LogConfiguration:
         â€‹LogDriver: splunk
         â€‹Options:
           â€‹mode: non-blocking
           â€‹splunk-format: raw
           â€‹splunk-insecureskipverify: 'true'
           â€‹splunk-source: docker
           â€‹splunk-sourcetype: listhub-prod
           â€‹splunk-token: 28016449-F03D-4597-BB18-9CD98DD83EEL
           â€‹splunk-url: https://splunk-hf2.moveaws.com:8088
           â€‹splunk-verify-connection: 'false'
           â€‹tag: '
        â€‹Memory: '7168
        â€‹MountPoints
        â€‹- ContainerPath: /tmp/reportsv2
         â€‹SourceVolume: report_cach
        â€‹Name: listhu
        â€‹PortMappings
        â€‹- ContainerPort: '800'
      â€‹Volums:
      â€‹- Host:
         â€‹SourcePath: /tmp/listhub-prod-report-cach
        â€‹Name: report_cahe
     â€‹

  â€‹TargetGoup:
    â€‹Type: AWS::ElasticLoadBalancingV2::Targetroup
    â€‹Propertis:
      â€‹VpcId
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-VC"
      â€‹Port:80
      â€‹Protocol: HTP
      â€‹Matcher
        â€‹HttpCode: 200-99
      â€‹HealthCheckIntervalSeconds: !Ref HealthCheckIntervalSecods
      â€‹HealthCheckPath: /servlet/staus
      â€‹HealthCheckProtocol: HTP
      â€‹HealthCheckTimeoutSeconds: !Ref HealthCheckTimeoutSecods
      â€‹HealthyThresholdCount 2
      â€‹UnhealthyThresholdCount 5
      â€‹TargetGroupAttributes
        â€‹- Key: deregistration_delay.timeout_seconds
         â€‹Value: 6
        â€‹- Key: stickiness.enabled
         â€‹Value: tru
        â€‹- Key: stickiness.lb_cookie.duration_seconds
         â€‹Value:86400

  â€‹HttpRedirectListenerule:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPriorty
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnme
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle2:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame2
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy2
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae2
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle3:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame3
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy3
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae3
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle4:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame4
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy4
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae4
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle5:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame5
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy5
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae5
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle6:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame6
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy6
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae6
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle7:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame7
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy7
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae7
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle8:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame8
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy8
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae8
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRle9:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame9
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPrioriy9
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae9
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTP_301

  â€‹HttpRedirectListenerRue10:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostnme10
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-http-listenr"
      â€‹Priority: !Ref AlbPriorit10
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnam10
      â€‹Actions
        â€‹- Type: redirect
         â€‹RedirectConfig:
           â€‹Host: "app.listhub.com"
           â€‹Path: "/#{path}"
           â€‹Port: 443
           â€‹Protocol: HTTPS
           â€‹StatusCode: HTT_301


  â€‹HttpsListenerule:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPriorty
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnme
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle2:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame2
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy2
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae2
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle3:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame3
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy3
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae3
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle4:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame4
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy4
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae4
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle5:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame5
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy5
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae5
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle6:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame6
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy6
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae6
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle7:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame7
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy7
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae7
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle8:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame8
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy8
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae8
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRle9:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostame9
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPrioriy9
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnae9
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹HttpsListenerRue10:
    â€‹Type: AWS::ElasticLoadBalancingV2::ListeneRule
    â€‹Condition: HasHostnme10
    â€‹Propertis:
      â€‹ListenerArn
        â€‹'Fn::ImportValue': "listhub-web-ecs-cluster-internet-facing-https-listenr"
      â€‹Priority: !Ref AlbPriorit10
      â€‹Conditions
        â€‹- Field: host-header
         â€‹Values:
           â€‹- !Ref Hostnam10
      â€‹Actions
        â€‹- Type: forward
         â€‹ForwardConfig:
           â€‹TargetGroups:
             â€‹- TargetGroupArn: !Ref TargetGroup
               â€‹Weight: !Ref NewTargetGroupWeight
             â€‹- !If
               â€‹- WeightedBlueGreen
               â€‹-
                 â€‹TargetGroupArn:
                   â€‹'Fn::ImportValue': 'listhub-prod-green-tg'
                 â€‹Weight: !Ref PrevTargetGroupWeight
               â€‹- !Ref "AWS::NoValue"
           â€‹TargetGroupStickinessConfig:
             â€‹DurationSeconds: 2000
             â€‹Enabled true

  â€‹# This IAM Role grants the service access to register/unregister wth the
  â€‹# Application Load Balancer (ALB). It is based on the default documente here:
  â€‹# http://docs.aws.amazon.com/AmazonECS/latest/developerguide/service_IAM_roe.html
  â€‹EcsServiceole:
    â€‹Type: AWS::IAM:Role
    â€‹Propertis:
      â€‹PermissionsBoundary: !Join ["", [ 'arn:aws:iam::', !Ref 'AWS::AccountId', ':policy/CloudServices-Boundary']]
      â€‹RoleName: !Sub svc-${AWS::StackNae}
      â€‹Path /
      â€‹AssumeRolePolicyDocument
        â€‹Version: "2012-10-17
        â€‹Statement:
         â€‹- Effect: Allow
           â€‹Principal:
             â€‹Service:
               â€‹- ecs.amazonaws.com
           â€‹Action:
             â€‹- sts:AssumeRle
      â€‹ManagedPolicyArns
        â€‹- arn:aws:iam::aws:policy/service-role/AmazonEC2ContainerServieRole

  â€‹Taskole:
    â€‹Type: AWS::IAM:Role
    â€‹Propertis:
      â€‹PermissionsBoundary: !Join ["", [ 'arn:aws:iam::', !Ref 'AWS::AccountId', ':policy/CloudServices-Boundary']]
      â€‹RoleName: !Sub svc-${AWS::StackName}-rle
      â€‹Path /
      â€‹AssumeRolePolicyDocument
        â€‹Version: "2012-10-17
        â€‹Statement:
         â€‹- Effect: Allow
           â€‹Principal:
             â€‹Service:
               â€‹- ecs-tasks.amazonaws.com
           â€‹Action:
             â€‹- sts:AssumeRle
      â€‹Policies
        â€‹- PolicyName: !Sub svc-${AWS::StackName}
         â€‹PolicyDocument:
           â€‹Version: "2012-10-17"
           â€‹Statement:
             â€‹- Action: '*'
               â€‹Effect: Allow
               â€‹Resource: '*'
           â€‹

Otputs:
  â€‹TargetGrouArn:
    â€‹Description: Target Grou ARN
    â€‹Value: !Ref Targetroup
    â€‹Expot:
      â€‹Name: !Sub ${AWS::StackName}-tg

[38;21m2020-12-01 22:32:49,069 Deploying stack listhub-prod-blue.
[38;21m2020-12-01 22:32:49,069 stack_params: [{'ParameterKey': 'ServiceName', 'ParameterValue': 'listhub-prod-blue'}, {'ParameterKey': 'Hostname', 'ParameterValue': 'i-app.listhub.moveaws.com'}, {'ParameterKey': 'AlbPriority', 'ParameterValue': '41607'}, {'ParameterKey': 'HealthCheckIntervalSeconds', 'ParameterValue': ''}, {'ParameterKey': 'HealthCheckTimeoutSeconds', 'ParameterValue': ''}]
[38;21m2020-12-01 22:33:07,167    listhub-prod-blue: CREATE_IN_PROGRESS User Initiated
[38;21m2020-12-01 22:33:14,455    HttpRedirectListenerRule: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    TargetGroup: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    AutoscalingRole: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    EcsServiceRole: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    HttpRedirectListenerRule: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    TaskRole: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    AutoscalingRole: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    TargetGroup: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    HttpRedirectListenerRule: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:14,456    TargetGroup: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:14,456    EcsServiceRole: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    TaskRole: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    HttpsListenerRule: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:14,456    HttpsListenerRule: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:14,456    HttpsListenerRule: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:22,136    EcsServiceRole: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:22,136    AutoscalingRole: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:29,412    TaskRole: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:29,412    TaskDefinition: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:37,006    TaskDefinition: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:37,006    TaskDefinition: CREATE_COMPLETE 
[38;21m2020-12-01 22:33:37,006    Service: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:33:44,612    Service: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:33:44,612   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/4e283201bea140abb166cee37291006f: PENDING -> RUNNING Containers=[listhub: PENDING]
[38;21m2020-12-01 22:33:44,612   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/79df59b114674c2db9030f8f7e76ef5f: PENDING -> RUNNING Containers=[listhub: PENDING]
[38;21m2020-12-01 22:33:44,612   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/ac05207913794738944e24d9da7d473c: PENDING -> RUNNING Containers=[listhub: PENDING]
[38;21m2020-12-01 22:33:44,612   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/da2c2e9198a84a72a982efb14854e988: PENDING -> RUNNING Containers=[listhub: PENDING]
[38;21m2020-12-01 22:33:52,545   (ECS-SVC) (service listhub-prod-blue) has started 4 tasks: (task 79df59b114674c2db9030f8f7e76ef5f) (task da2c2e9198a84a72a982efb14854e988) (task ac05207913794738944e24d9da7d473c) (task 4e283201bea140abb166cee37291006f).
[38;21m2020-12-01 22:34:39,924   (ECS-SVC) (service listhub-prod-blue) registered 1 targets in (target-group arn:aws:elasticloadbalancing:us-east-1:104222541211:targetgroup/listh-Targe-1OZAT8OUJVOIU/63990be90fb5fbb9)
[38;21m2020-12-01 22:34:39,924   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/79df59b114674c2db9030f8f7e76ef5f: RUNNING Containers=[listhub: RUNNING]
[38;21m2020-12-01 22:34:39,924   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/ac05207913794738944e24d9da7d473c: RUNNING Containers=[listhub: RUNNING]
[38;21m2020-12-01 22:34:39,924   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/da2c2e9198a84a72a982efb14854e988: RUNNING Containers=[listhub: RUNNING]
[38;21m2020-12-01 22:34:47,429   (ECS-SVC) (service listhub-prod-blue) registered 2 targets in (target-group arn:aws:elasticloadbalancing:us-east-1:104222541211:targetgroup/listh-Targe-1OZAT8OUJVOIU/63990be90fb5fbb9)
[38;21m2020-12-01 22:34:54,948    Service: CREATE_COMPLETE 
[38;21m2020-12-01 22:34:54,949   (ECS-SVC) (service listhub-prod-blue) registered 1 targets in (target-group arn:aws:elasticloadbalancing:us-east-1:104222541211:targetgroup/listh-Targe-1OZAT8OUJVOIU/63990be90fb5fbb9)
[38;21m2020-12-01 22:34:54,949   (ECS) arn:aws:ecs:us-east-1:104222541211:task/listhub-web-ecs-cluster/4e283201bea140abb166cee37291006f: RUNNING Containers=[listhub: RUNNING]
[38;21m2020-12-01 22:35:03,414    ServiceScalingTarget: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:35:03,414    ServiceScalingTarget: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:35:03,414    ServiceScalingTarget: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:03,414    ServiceScaleDownPolicy: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:35:03,414    ServiceScaleUpPolicy: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:35:11,372    ServiceScaleDownPolicy: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:35:11,373    ServiceScaleDownPolicy: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:11,373    ServiceScaleUpPolicy: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:35:11,373    ServiceScaleUpPolicy: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:11,373    ScaleDown: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:35:11,373    ScaleDown: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:35:11,373    ScaleDown: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:11,373    ScaleUp: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:35:11,373    ScaleUp: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:35:11,373    ScaleUp: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:19,973    listhub-prod-blue: CREATE_COMPLETE 
[38;21m2020-12-01 22:35:19,973   (ECS-SVC) (service listhub-prod-blue) (deployment ecs-svc/8020907472756605907) deployment completed.
[38;21m2020-12-01 22:35:19,973   (ECS-SVC) (service listhub-prod-blue) has reached a steady state.
[38;21m2020-12-01 22:35:20,300 Finished CF deployment in 0:02:35.356346.
INFO: We have not crossed any service limits for CloudFormation
INFO: Skipping Terminate Protect as flag is not set
+ finish
+ rm -f /tmp/tmp.jnfieK /tmp/tmp.MCAKKD
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librarce (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pipeline] archivcs (hide)
ï¿¼Archiving artifacts
[Pi h (hide)
ï¿¼+ rm /tmp/tmp.FREGzKksHY
[Pipeco (hide)
ï¿¼Giving the containers a few seconds to start up before running tests.
[Pipelep (hide)
ï¿¼Sleeping for 5 sec
[Pipelage (hide)
[Pipeline] { (prod Inactive Sst) (hide)
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pi h (hide)
ï¿¼+ jenkins-hooks/integration-tests.sh i-app.listhub.moveaws.com
+ BASE_URL=i-app.listhub.moveaws.com
+ docker run --rm appropriate/curl -f -v -L i-app.listhub.moveaws.com/servlet/status
Unable to find image 'appropriate/curl:latest' locally
latest: Pulling from appropriate/curl
ff3a5c916c92: Pulling fs layer
3151abf94102: Pulling fs layer
58ae3cb4aac4: Pulling fs layer
58ae3cb4aac4: Verifying Checksum
58ae3cb4aac4: Download complete
3151abf94102: Verifying Checksum
3151abf94102: Download complete
ff3a5c916c92: Verifying Checksum
ff3a5c916c92: Download complete
ff3a5c916c92: Pull complete
3151abf94102: Pull complete
58ae3cb4aac4: Pull complete
Digest: sha256:c8bf5bbec6397465a247c2bb3e589bb77e4f62ff88a027175ecb2d9e4f12c9d7
Status: Downloaded newer image for appropriate/curllatest
  â€‹% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                â€‹Dload  Upload   Total   Spent    Left Speed

  â€‹0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 52.54.247.183...
* TCP_NODELAY set
* Connected to i-app.listhub.moveaws.com (52.54.247.183) port 80 (#0)
> GET /servlet/status HTTP/1.1
> Host: i-app.listhub.moveaws.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
< HTTP/1.1 301 Moved Permanently
< Server: awselb/2.0
< Date: Tue, 01 Dec 2020 22:35:38 GMT
< Content-Type: text/html
< Content-Length: 134
< Connection: keep-alive
< Location: https://app.listhub.com:443/servlet/status
< 
* Ignoring the response-body
{ [134 bytes data]

100   134  100   134    0     0    870      0 --:--:-- --:--:-- --:--:--   870
* Connection #0 to host i-app.listhub.moveaws.com left intact
* Issue another request to this URL: 'https://app.listhub.com:443/servlet/status'
*   Trying 107.21.76.62...
* TCP_NODELAY set
* Connected to app.listhub.com (107.21.76.62) port 443 (#1)
* ALPN, offering http/1.1
* successfully set certificate verify loctions:
  â€‹CAfile: /etc/ssl/certs/ca-certificaes.crt
  â€‹CApath: none
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
} [230 bytes data]
* TLSv1.2 (IN), TLS handshake, Server hello (2):
{ [104 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4890 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Client hello (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Client hello (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server accepted to use http/1.1
* Server certificate:
*  subject: CN=*.listhub.com
*  start date: Aug 29 00:00:00 2020 GMT
*  expire date: Sep 29 12:00:00 2021 GMT
*  subjectAltName: host "app.listhub.com" matched cert's "*.listhub.com"
*  issuer: C=US; O=Amazon; OU=Server CA 1B; CN=Amazon
*  SSL certificate verify ok.
> GET /servlet/status HTTP/1.1
> Host: app.listhub.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
< HTTP/1.1 200 OK
< Date: Tue, 01 Dec 2020 22:35:38 GMT
< Transfer-Encoding: chunked
< Connection: keep-alive
< Set-Cookie: AWSALBTG=tmy/laM6W9G8JcmEznYWeminQyiCYp/RpQXpx93hIyxXs8tMSYLF7Hp1G5j8JLseb5mtBBLidAbUxDp1utr/agKSHP85JNK5SewjoFgGtCeMw8wFSkW36VFVV9MX44UXgSu9AHQ+2p7u6/x4lb0a8WS2Eq/svgKBbKq9aNCzfr5I; Expires=Tue, 08 Dec 2020 22:35:38 GMT; Path=/
< Set-Cookie: AWSALBTGCORS=tmy/laM6W9G8JcmEznYWeminQyiCYp/RpQXpx93hIyxXs8tMSYLF7Hp1G5j8JLseb5mtBBLidAbUxDp1utr/agKSHP85JNK5SewjoFgGtCeMw8wFSkW36VFVV9MX44UXgSu9AHQ+2p7u6/x4lb0a8WS2Eq/svgKBbKq9aNCzfr5I; Expires=Tue, 08 Dec 2020 22:35:38 GMT; Path=/; SameSite=None; Secure
< Set-Cookie: AWSALB=enh0STFWlMR2PvVi/rScs1uGX/vn2LfOVxbOYGy9Zoi32pERYuyqLkMmK4YFodOcDnpbXIcrJ7At0sgCVXfb589IXC1Z0E13pZ/kxjio4bvfgfcjmOFYBFwicm7I; Expires=Tue, 08 Dec 2020 22:35:38 GMT; Path=/
< Set-Cookie: AWSALBCORS=enh0STFWlMR2PvVi/rScs1uGX/vn2LfOVxbOYGy9Zoi32pERYuyqLkMmK4YFodOcDnpbXIcrJ7At0sgCVXfb589IXC1Z0E13pZ/kxjio4bvfgfcjmOFYBFwicm7I; Expires=Tue, 08 Dec 2020 22:35:38 GMT; Path=/; SameSite=None; Secure
< Server: Jetty(9.4.15.v20190215)
< 
{ [40 bytes data]
Application Successfully Verified

100    34    0    34    0     0     79      0 --:--:-- --:--:-- --:--:--    79
* Connection #1 to host app.listhub.com left intact
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librarce (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pipeline] archivcs (hide)
ï¿¼Archiving artifacts
[Pi h (hide)
ï¿¼+ rm /tmp/tmp.rToXtPGEp9
[Pipelage (hide)
[Pipeline] { (prod Swap Target Grts) (hide)
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_ecs_blue_green_deploy_phase3_swap_target_group_hosts.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼++ mktemp
+ PARAMFILE=/tmp/tmp.KpdFoj
+ trap finish EXIT
+ cat
++ get_alb_hostname app.listhub.com unused.internal
++ '[' app.listhub.com '!=' '' ']'
++ echo app.listhub.com
++ get_alb_hostname app.listhub.net unused.internal
++ '[' app.listhub.net '!=' '' ']'
++ echo app.listhub.net
++ get_alb_hostname reports.listhub.com unused.internal
++ '[' reports.listhub.com '!=' '' ']'
++ echo reports.listhub.com
++ get_alb_hostname reports.listhub.net unused.internal
++ '[' reports.listhub.net '!=' '' ']'
++ echo reports.listhub.net
++ get_alb_hostname listings.listhub.com unused.internal
++ '[' listings.listhub.com '!=' '' ']'
++ echo listings.listhub.com
++ get_alb_hostname listings.listhub.net unused.internal
++ '[' listings.listhub.net '!=' '' ']'
++ echo listings.listhub.net
++ get_alb_hostname feeds.listhub.net unused.internal
++ '[' feeds.listhub.net '!=' '' ']'
++ echo feeds.listhub.net
++ get_alb_hostname feeds.listhub.com unused.internal
++ '[' feeds.listhub.com '!=' '' ']'
++ echo feeds.listhub.com
++ get_alb_hostname '' unused.internal
++ '[' '' '!=' '' ']'
++ echo unused.internal
+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/cf_simple_deploy.py --stack_name listhub-prod-blue --params_path /tmp/tmp.KpdFoj --ecs_cluster listhub-web-ecs-cluster --ecs_service_name '' --strip_missing_parameters --extra_tag Name=listhub-prod owner=sysadmin@listhub.com product=listhub component=app environment=prod --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole --variables_path /usr/local/aws-deploy-tools/variables/aws-globals.yml /usr/local/aws-deploy-tools/variables/aws-listhub-prod-us-east-1.yml /usr/local/aws-deploy-tools/variables/move-deprecated.yml jenkins-deploy/listhub-prod/env-vars.yml /usr/local/aws-deploy-tools/variables/elb-internet-facing.yml deployment/vars.listhub-common.yml deployment/vars.listhub-prod.yml
[38;21m2020-12-01 22:35:57,767 Rendered CloudFormation parameters:
ServiceName: "listhub-prod-blue"
Hostname: "app.listhub.moveaws.com"
Hostname2: "app.listhub.com"
Hostname3: "app.listhub.net"
Hostname4: "reports.listhub.com"
Hostname5: "reports.listhub.net"
Hostname6: "listings.listhub.com"
Hostname7: "listings.listhub.net"
Hostname8: "feeds.listhub.net"
Hostname9: "feeds.listhub.com"
Hostname10: "unused.internal"
AlbPriority: "41607"
AlbPriority2: "23190"
AlbPriority3: "26057"
AlbPriority4: "49143"
AlbPriority5: "30042"
AlbPriority6: "28132"
AlbPriority7: "33136"
AlbPriority8: "48277"
AlbPriority9: "17927"
AlbPriority10: "-1"
HealthCheckIntervalSeconds: ""
HealthCheckTimeoutSeconds: ""

[38;21m2020-12-01 22:35:57,877 Deploying stack listhub-prod-blue.
[38;21m2020-12-01 22:35:57,877 stack_params: [{'ParameterKey': 'ServiceName', 'ParameterValue': 'listhub-prod-blue'}, {'ParameterKey': 'Hostname', 'ParameterValue': 'app.listhub.moveaws.com'}, {'ParameterKey': 'Hostname2', 'ParameterValue': 'app.listhub.com'}, {'ParameterKey': 'Hostname3', 'ParameterValue': 'app.listhub.net'}, {'ParameterKey': 'Hostname4', 'ParameterValue': 'reports.listhub.com'}, {'ParameterKey': 'Hostname5', 'ParameterValue': 'reports.listhub.net'}, {'ParameterKey': 'Hostname6', 'ParameterValue': 'listings.listhub.com'}, {'ParameterKey': 'Hostname7', 'ParameterValue': 'listings.listhub.net'}, {'ParameterKey': 'Hostname8', 'ParameterValue': 'feeds.listhub.net'}, {'ParameterKey': 'Hostname9', 'ParameterValue': 'feeds.listhub.com'}, {'ParameterKey': 'Hostname10', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'AlbPriority', 'ParameterValue': '41607'}, {'ParameterKey': 'AlbPriority2', 'ParameterValue': '23190'}, {'ParameterKey': 'AlbPriority3', 'ParameterValue': '26057'}, {'ParameterKey': 'AlbPriority4', 'ParameterValue': '49143'}, {'ParameterKey': 'AlbPriority5', 'ParameterValue': '30042'}, {'ParameterKey': 'AlbPriority6', 'ParameterValue': '28132'}, {'ParameterKey': 'AlbPriority7', 'ParameterValue': '33136'}, {'ParameterKey': 'AlbPriority8', 'ParameterValue': '48277'}, {'ParameterKey': 'AlbPriority9', 'ParameterValue': '17927'}, {'ParameterKey': 'AlbPriority10', 'ParameterValue': '-1'}, {'ParameterKey': 'HealthCheckIntervalSeconds', 'ParameterValue': ''}, {'ParameterKey': 'HealthCheckTimeoutSeconds', 'ParameterValue': ''}]
[38;21m2020-12-01 22:36:15,226    listhub-prod-blue: UPDATE_IN_PROGRESS User Initiated
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule6: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule5: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpRedirectListenerRule3: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpRedirectListenerRule4: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule9: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpRedirectListenerRule5: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule6: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule4: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule5: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,581    HttpRedirectListenerRule7: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpRedirectListenerRule9: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,581    HttpsListenerRule8: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule7: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule: UPDATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule6: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule4: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule9: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule3: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule4: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule5: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule3: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule8: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule6: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule9: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule: UPDATE_COMPLETE 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule: UPDATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule7: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule6: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule4: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule7: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,582    HttpRedirectListenerRule2: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,582    HttpsListenerRule9: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule8: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule3: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule3: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule5: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule: UPDATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule4: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule5: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule8: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule2: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule6: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule9: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule7: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule8: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule7: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule3: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule8: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpRedirectListenerRule2: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule2: CREATE_IN_PROGRESS 
[38;21m2020-12-01 22:36:23,583    HttpsListenerRule2: CREATE_IN_PROGRESS Resource creation Initiated
[38;21m2020-12-01 22:36:23,584    HttpsListenerRule2: CREATE_COMPLETE 
[38;21m2020-12-01 22:36:32,165    listhub-prod-blue: UPDATE_COMPLETE_CLEANUP_IN_PROGRESS 
[38;21m2020-12-01 22:36:32,165    listhub-prod-blue: UPDATE_COMPLETE 
[38;21m2020-12-01 22:36:32,393 Finished CF deployment in 0:00:38.807016.
INFO: Skipping Terminate Protect as flag is not set
+ cat
+ /usr/bin/env python3 -B /usr/local/aws-deploy-tools/src/cf_simple_deploy.py --stack_name listhub-prod-green --params_path /tmp/tmp.KpdFoj --ecs_cluster listhub-web-ecs-cluster --ecs_service_name '' --strip_missing_parameters --extra_tag Name=listhub-prod owner=sysadmin@listhub.com product=listhub component=app environment=prod --region_name us-east-1 --assume_role_arn arn:aws:iam::104222541211:role/Jenkins --role_session_name JenkinsRole --variables_path /usr/local/aws-deploy-tools/variables/aws-globals.yml /usr/local/aws-deploy-tools/variables/aws-listhub-prod-us-east-1.yml /usr/local/aws-deploy-tools/variables/move-deprecated.yml jenkins-deploy/listhub-prod/env-vars.yml /usr/local/aws-deploy-tools/variables/elb-internet-facing.yml deployment/vars.listhub-common.yml deployment/vars.listhub-prod.yml
[38;21m2020-12-01 22:36:37,125 Rendered CloudFormation parameters:
ServiceName: "listhub-prod-green"
Hostname: "i-app.listhub.moveaws.com"
Hostname2: "unused.internal"
Hostname3: "unused.internal"
Hostname4: "unused.internal"
Hostname5: "unused.internal"
Hostname6: "unused.internal"
Hostname7: "unused.internal"
Hostname8: "unused.internal"
Hostname9: "unused.internal"
Hostname10: "unused.internal"
AlbPriority: "25800"
AlbPriority2: "31608"
AlbPriority3: "16224"
AlbPriority4: "39772"
AlbPriority5: "43980"
AlbPriority6: "42554"
AlbPriority7: "17378"
AlbPriority8: "28544"
AlbPriority9: "49618"
AlbPriority10: "-1"
HealthCheckIntervalSeconds: ""
HealthCheckTimeoutSeconds: ""

[38;21m2020-12-01 22:36:37,251 Deploying stack listhub-prod-green.
[38;21m2020-12-01 22:36:37,251 stack_params: [{'ParameterKey': 'ServiceName', 'ParameterValue': 'listhub-prod-green'}, {'ParameterKey': 'Hostname', 'ParameterValue': 'i-app.listhub.moveaws.com'}, {'ParameterKey': 'Hostname2', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname3', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname4', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname5', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname6', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname7', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname8', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname9', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'Hostname10', 'ParameterValue': 'unused.internal'}, {'ParameterKey': 'AlbPriority', 'ParameterValue': '25800'}, {'ParameterKey': 'AlbPriority2', 'ParameterValue': '31608'}, {'ParameterKey': 'AlbPriority3', 'ParameterValue': '16224'}, {'ParameterKey': 'AlbPriority4', 'ParameterValue': '39772'}, {'ParameterKey': 'AlbPriority5', 'ParameterValue': '43980'}, {'ParameterKey': 'AlbPriority6', 'ParameterValue': '42554'}, {'ParameterKey': 'AlbPriority7', 'ParameterValue': '17378'}, {'ParameterKey': 'AlbPriority8', 'ParameterValue': '28544'}, {'ParameterKey': 'AlbPriority9', 'ParameterValue': '49618'}, {'ParameterKey': 'AlbPriority10', 'ParameterValue': '-1'}, {'ParameterKey': 'HealthCheckIntervalSeconds', 'ParameterValue': ''}, {'ParameterKey': 'HealthCheckTimeoutSeconds', 'ParameterValue': ''}]
[38;21m2020-12-01 22:36:54,290    listhub-prod-green: UPDATE_IN_PROGRESS User Initiated
[38;21m2020-12-01 22:37:02,139    HttpsListenerRule: UPDATE_IN_PROGRESS 
[38;21m2020-12-01 22:37:02,139    HttpsListenerRule: UPDATE_COMPLETE 
[38;21m2020-12-01 22:37:02,140    HttpRedirectListenerRule: UPDATE_IN_PROGRESS 
[38;21m2020-12-01 22:37:02,140    HttpRedirectListenerRule: UPDATE_COMPLETE 
[38;21m2020-12-01 22:37:09,583    listhub-prod-green: UPDATE_COMPLETE_CLEANUP_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule6: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule2: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule6: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule7: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule9: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule3: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule9: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule4: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule3: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule8: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpsListenerRule5: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule8: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule7: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,583    HttpRedirectListenerRule4: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule2: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule5: DELETE_IN_PROGRESS 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule6: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule9: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule9: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule5: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule7: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule7: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule2: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule4: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule6: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule3: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule8: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule5: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule2: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule3: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpsListenerRule8: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,584    HttpRedirectListenerRule4: DELETE_COMPLETE 
[38;21m2020-12-01 22:37:09,585    listhub-prod-green: UPDATE_COMPLETE 
[38;21m2020-12-01 22:37:09,828 Finished CF deployment in 0:00:37.183601.
INFO: Skipping Terminate Protect as flag is not set
+ finish
+ rm -f /tmp/tmp.KpdFoj
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pi h (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[Pi h (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] hest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librarce (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pi sh (hide)
[Pipeline] archivcs (hide)
ï¿¼Archiving artifacts
[Pi h (hide)
ï¿¼+ rm /tmp/tmp.8rtwP3EHXc
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_new_relic_notify.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼Skipping New Relic deployment notification since the newRelicAppId variable is not set.
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline]lor (hide)
[P] { (hide)
[Pipeco (hide)
ï¿¼Executing move_sns_send.sh.template
[Pipeline] sts (hide)
[Pi sh (hide)
[Pipeline]ile (hide)
[Pipeline]ile (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi sh (hide)
[Pi sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[Pi h (hide)
ï¿¼Skipping SNS notification since a topic ARN is not configured.
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // node
[Pipeoe (hide)
ï¿¼Running on jenkins-slave-co7 (i-03bac934522239a04) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master
[P] { (hide)
[Pipelineot (hide)
ï¿¼using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
Fetching changes from the remote Git repository
Fetching without tags
Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
Commit message: "fixed merge conflict"
[Pipelage (hide)
[Pipeline] { (prod Sst) (hide)
[Pi h (hide)
ï¿¼ â€‹> git rev-parse --is-inside-work-tree # tmeout=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/lithub.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key frm master
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/orign/master
 â€‹> git config core.sparsecheckout # tmeout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a277bb4df28
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[P]sh (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipelineolor (hide)
[e] { (hide)
[Pipeho (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipelep (hide)
ï¿¼Sleeping for 1 sec
[P]sh (hide)
ï¿¼+ jenkins-hooks/smoke-tests.sh app.listhub.moveaws.com
+ BASE_URL=app.listhub.moveaws.com
+ docker run --rm appropriate/curl -f -v -L app.listhub.moveaws.com/servle/status
  â€‹% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                â€‹Dload  Upload   Total   Spent    Left Speed

  â€‹0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 52.54.247.183...
* TCP_NODELAY set
* Connected to app.listhub.moveaws.com (52.54.247.183) port 80 (#0)
> GET /servlet/status HTTP/1.1
> Host: app.listhub.moveaws.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
< HTTP/1.1 301 Moved Permanently
< Server: awselb/2.0
< Date: Tue, 01 Dec 2020 22:37:34 GMT
< Content-Type: text/html
< Content-Length: 134
< Connection: keep-alive
< Location: https://app.listhub.com:443/servlet/status
< 
* Ignoring the response-body
{ [134 bytes data]

100   134  100   134    0     0    770      0 --:--:-- --:--:-- --:--:--   770
* Connection #0 to host app.listhub.moveaws.com left intact
* Issue another request to this URL: 'https://app.listhub.com:443/servlet/status'
*   Trying 107.21.76.62...
* TCP_NODELAY set
* Connected to app.listhub.com (107.21.76.62) port 443 (#1)
* ALPN, offering http/1.1
* successfully set certificate verify loations:
  â€‹CAfile: /etc/ssl/certs/ca-certifictes.crt
  â€‹CApath: none
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
} [230 bytes data]
* TLSv1.2 (IN), TLS handshake, Server hello (2):
{ [104 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4890 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Client hello (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Client hello (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server accepted to use http/1.1
* Server certificate:
*  subject: CN=*.listhub.com
*  start date: Aug 29 00:00:00 2020 GMT
*  expire date: Sep 29 12:00:00 2021 GMT
*  subjectAltName: host "app.listhub.com" matched cert's "*.listhub.com"
*  issuer: C=US; O=Amazon; OU=Server CA 1B; CN=Amazon
*  SSL certificate verify ok.
> GET /servlet/status HTTP/1.1
> Host: app.listhub.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
< HTTP/1.1 200 OK
< Date: Tue, 01 Dec 2020 22:37:34 GMT
< Transfer-Encoding: chunked
< Connection: keep-alive
< Set-Cookie: AWSALBTG=d822CQUG3mZacu3E4EC1ZgcCwPkzAZouLA6ZzM/5iwQtZfJrda7+qlyaxa+E8lmtZVAGcE909KoPR4GhV464jspLC4JFbNVrVDG98kk1jYDUieEuIQq/UQLz/dyzumDXNghGwMBJDftSUJmUM9Q6+0RiArfGt13+ZCShdR9J0NiG; Expires=Tue, 08 Dec 2020 22:37:34 GMT; Path=/
< Set-Cookie: AWSALBTGCORS=d822CQUG3mZacu3E4EC1ZgcCwPkzAZouLA6ZzM/5iwQtZfJrda7+qlyaxa+E8lmtZVAGcE909KoPR4GhV464jspLC4JFbNVrVDG98kk1jYDUieEuIQq/UQLz/dyzumDXNghGwMBJDftSUJmUM9Q6+0RiArfGt13+ZCShdR9J0NiG; Expires=Tue, 08 Dec 2020 22:37:34 GMT; Path=/; SameSite=None; Secure
< Set-Cookie: AWSALB=onh+eh2lqM1An68PFup1qzVrtAsUA01eSH44qyQLYOfMR8s/hXvflMeuZfaclW4WmGSxJDwdMspd6JmLAGsWejgsQPAgaersOWqRJFsaRMez64aRoDAwe4Uw81IK; Expires=Tue, 08 Dec 2020 22:37:34 GMT; Path=/
< Set-Cookie: AWSALBCORS=onh+eh2lqM1An68PFup1qzVrtAsUA01eSH44qyQLYOfMR8s/hXvflMeuZfaclW4WmGSxJDwdMspd6JmLAGsWejgsQPAgaersOWqRJFsaRMez64aRoDAwe4Uw81IK; Expires=Tue, 08 Dec 2020 22:37:34 GMT; Path=/; SameSite=None; Secure
< Server: Jetty(9.4.15.v20190215)
< 
{ [40 bytes data]

100    34    0    34    0     0 Application Successfully Veified
    â€‹69      0 --:--:-- --:--:-- --:--:--    69
* Connection #1 to host app.listhub.com left intact
+ docker run --rm appropriate/curl -f -v -L 'app.listhub.moveaws.com/servlet/status?test_datasorces=1'
  â€‹% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                â€‹Dload  Upload   Total   Spent    Left Speed

  â€‹0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 107.21.76.62...
* TCP_NODELAY set
* Connected to app.listhub.moveaws.com (107.21.76.62) port 80 (#0)
> GET /servlet/status?test_datasources=1 HTTP/1.1
> Host: app.listhub.moveaws.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
< HTTP/1.1 301 Moved Permanently
< Server: awselb/2.0
< Date: Tue, 01 Dec 2020 22:37:35 GMT
< Content-Type: text/html
< Content-Length: 134
< Connection: keep-alive
< Location: https://app.listhub.com:443/servlet/status?test_datasources=1
< 
* Ignoring the response-body
{ [134 bytes data]

100   134  100   134    0     0    992      0 --:--:-- --:--:-- --:--:--   992
* Connection #0 to host app.listhub.moveaws.com left intact
* Issue another request to this URL: 'https://app.listhub.com:443/servlet/status?test_datasources=1'
*   Trying 107.21.76.62...
* TCP_NODELAY set
* Connected to app.listhub.com (107.21.76.62) port 443 (#1)
* ALPN, offering http/1.1
* successfully set certificate verify loations:
  â€‹CAfile: /etc/ssl/certs/ca-certifictes.crt
  â€‹CApath: none
* TLSv1.2 (OUT), TLS handshake, Client hello (1):
} [230 bytes data]
* TLSv1.2 (IN), TLS handshake, Server hello (2):
{ [104 bytes data]
* TLSv1.2 (IN), TLS handshake, Certificate (11):
{ [4890 bytes data]
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
{ [333 bytes data]
* TLSv1.2 (IN), TLS handshake, Server finished (14):
{ [4 bytes data]
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
} [70 bytes data]
* TLSv1.2 (OUT), TLS change cipher, Client hello (1):
} [1 bytes data]
* TLSv1.2 (OUT), TLS handshake, Finished (20):
} [16 bytes data]
* TLSv1.2 (IN), TLS change cipher, Client hello (1):
{ [1 bytes data]
* TLSv1.2 (IN), TLS handshake, Finished (20):
{ [16 bytes data]
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server accepted to use http/1.1
* Server certificate:
*  subject: CN=*.listhub.com
*  start date: Aug 29 00:00:00 2020 GMT
*  expire date: Sep 29 12:00:00 2021 GMT
*  subjectAltName: host "app.listhub.com" matched cert's "*.listhub.com"
*  issuer: C=US; O=Amazon; OU=Server CA 1B; CN=Amazon
*  SSL certificate verify ok.
> GET /servlet/status?test_datasources=1 HTTP/1.1
> Host: app.listhub.com
> User-Agent: curl/7.59.0
> Accept: */*
> 
* The requested URL returned error: 500 Serve Error

  â€‹0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
* Closing connection 1
* TLSv1.2 (OUT), TLS alert, Client hello (1):
} [2 bytes data]
curl: (22) The requested URL returned error: 500 Server Error
[Pipeline] }
[Pipeline] // stage
[Pipelineolor (hide)
[e] { (hide)
[Pipeho (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[P]sh (hide)
ï¿¼+ vault kv get --field=access_token kv/external-tools-secrets/github
[P]sh (hide)
ï¿¼+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipeho (hide)
ï¿¼Posting message to #listhub-status in slack: Stage prod Smoke Test in job <https://jenkins.moveaws.com/job/IndustryPlatforms/job/GithubOrg/job/IndustryPlatforms/job/listhub/job/master/372/|IndustryPlatforms/GithubOrg/IndustryPlatforms/listhub/master> failed. 
Attachment: [[color:#d30000, fallback:Stage prod Smoke Test in job <https://jenkins.moveaws.com/job/IndustryPlatforms/job/GithubOrg/job/IndustryPlatforms/job/listhub/job/master/372/|IndustryPlatforms/GithubOrg/IndustryPlatforms/listhub/master> failed., author_name:IndustryPlatforms/GithubOrg/IndustryPlatforms/listhub/master, title:Build Failed, title_link:https://jenkins.moveaws.com/job/IndustryPlatforms/job/GithubOrg/job/IndustryPlatforms/job/listhub/job/master/372/, text:```
script returned exit code 22
```, mrkdwn_in:[text], fields:[[title:Repo, value:<https://github.move.com/IndustryPlatforms/listhub|listhub>, short:true], [title:Branch, value:<https://github.move.com/IndustryPlatforms/listhub/compare/master|master>, short:true], [title:Stage, value:<https://jenkins.moveaws.com/job/IndustryPlatforms/job/GithubOrg/job/IndustryPlatforms/job/listhub/job/master/372//artifact/jenkins-deploy/stage-capture/stage-prod_Smoke_Test-1606862250345.html|prod Smoke Test>, short:false]]]]
[PipelineSnd (hide)
ï¿¼Slack Send Pipeline step running, values are - baseUrl: <empty>, teamDomain: moveinc, channel: #listhub-status, color: #d30000, botUser: false, tokenCredentialId: ba2fac9a-5ef3-4af1-9c4f-c2ab61b46a3a, notifyCommitters: false, iconEmoji: <empty>, username: <empty>
[Pipelineolor (hide)
[e] { (hide)
[Pipeho (hide)
ï¿¼
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librurce (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[Pipeline] archiats (hide)
ï¿¼Archiving artifacts
[P]sh (hide)
ï¿¼+ rm /tmp/tmp.Uy6r9MQSxA
[Pipeline] }
[Pipeline] // node
[Pipnde (hide)
ï¿¼Running on jenkins-slave-co7 (i-03bac934522239a04) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master
[e] { (hide)
[Pipelinkut (hide)
ï¿¼using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
Fetching changes from the remote Git repository
Fetching without tags
Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
Commit message: "fixed merge onflict"
 â€‹> git rev-parse --is-inside-work-tree # tmeout=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/lithub.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key frm master
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/orign/master
 â€‹> git config core.sparsecheckout # tmeout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a2077bb4df28
[Pipelineolor (hide)
[e] { (hide)
[Pipeho (hide)
ï¿¼Executing move_new_relic_notify.template
[Pipeline]ists (hide)
[P] sh (hide)
[PipelineFile (hide)
[PipelineFile (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P]sh (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P] sh (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P]sh (hide)
ï¿¼Skipping New Relic deployment notification since the newRelicAppId variable is not set.
[Pipeline] }
[Pipeline] // ansiColor
[Pipelineolor (hide)
[e] { (hide)
[Pipeho (hide)
ï¿¼Executing move_sns_send.sh.template
[Pipeline]ists (hide)
[P] sh (hide)
[PipelineFile (hide)
[PipelineFile (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P]sh (hide)
ï¿¼+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P] sh (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P]sh (hide)
ï¿¼Skipping SNS notification since a topic ARN is not configured.
[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] }
[Pipeline] // node
[Pipeline] }
Failed in branch main
[Pipeline] // parallel
[Pipeline] }
Failed in branch main
[Pipeline] // parallel
[Pipecho (hide)
ERROR: General Exception Caught During (executePipeline)
[Pipecho (hide)
ERROR: executePipeline (script returned exit code 22)
[Pipecho (hide)
DEBUG: Function Called (completePipeline)
[Pipnode (hide)
Running on jenkins-slave-co7 (i-00824bebc16a60c37) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master
[e] { (hide)
[Pipetage (hide)
[Pipeline] { (Calculation) (hide)
[P] sh (hide)
+ vault kv get --field=access_token kv/external-tools-secrets/github
[P] sh (hide)
+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[Pipecho (hide)
DEBUG: Pipeline Time Calculation Started
[Pipecho (hide)
DEBUG: Pipeline timeStop (Tue Dec 01 22:37:59 UTC 2020)
[Pipecho (hide)
DEBUG: Pipeline Duration Unformatted (34 minutes, 9.911 seconds)
[Pipecho (hide)
INFO: Pipeline Duration Formatted (0:34:9)
[Pipecho (hide)
DEBUG: Duration in Milliseconds (2049911)
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[P] sh (hide)
+ vault kv get --field=access_token kv/external-tools-secrets/github
[P] sh (hide)
+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librurce (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[Pipeline] archiacts (hide)
Archiving artifacts
[P] sh (hide)
+ rm /tmp/tmp.wbItqIOGqP
[Pipeline] }
[Pipeline] // node
[Pipnode (hide)
Running on jenkins-slave-co7 (i-00824bebc16a60c37) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master
[e] { (hide)
[Pipelinkout (hide)
using credential 4c024f87-baf1-47c9-8eca-97ab168ac0f5
Fetching changes from the remote Git repository
Fetching without tags
Checking out Revision 772e7bddb4223e3e00589673d847a2077bb4df28 (master)
Commit message: "fixed merge conflict"
[Pipetage (hide)
[Pipeline] { (pEnd) (hide)
[P] h (hide)
 â€‹> git rev-parse --is-inside-work-tree # tmeout=10
 â€‹> git config remote.origin.url git@github.move.com:IndustryPlatforms/listhub.git # timeout=10
Fetching upstream changes from git@github.move.com:IndustryPlatforms/lithub.git
 â€‹> git --version # timeout=10
using GIT_SSH to set credentials jenkins ssh key frm master
 â€‹> git fetch --no-tags --progress git@github.move.com:IndustryPlatforms/listhub.git +refs/heads/master:refs/remotes/orign/master
 â€‹> git config core.sparsecheckout # tmeout=10
 â€‹> git checkout -f 772e7bddb4223e3e00589673d847a2077bb4df28
+ vault kv get --field=access_token kv/external-tools-secrets/github
[P] sh (hide)
+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)
Executing move_send_pipeline_event.sh.template
[P] sh (hide)
[PipelineFile (hide)
[PipelineFile (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.getBuildinfo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P] sh (hide)
+ set +x
+ set +x
expected to call org.kohsuke.groovy.sandbox.impl.SandboxedMethodClosure.call but wound up catching moveContainerRegistry.dockerPull; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P] sh (hide)
[P] sh (hide)
expected to call java.util.LinkedHashMap.run but wound up catching moveContainerRegistry.dockerRun; see: https://jenkins.io/redirect/pipeline-cps-method-mismatches/
[P] sh (hide)
[Pipeline] }
[Pipeline] // ansiColor
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[P] sh (hide)
+ vault kv get --field=access_token kv/external-tools-secrets/github
[P] sh (hide)
+ git rev-parse HEAD
[Pipeline] uest (hide)
[Pipeline] }
[Pipeline] // stage
[Pipelineolor (hide)
[e] { (hide)
[Pipecho (hide)

[Pipeline] }
[Pipeline] // ansiColor
[Pipeline] librurce (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[P] sh (hide)
[Pipeline] archiacts (hide)
Archiving artifacts
[P] sh (hide)
+ rm /tmp/tmp.T9JuG0ywOY
[Pipeline] }
[Pipeline] // node
[Pipnode (hide)
Running on jenkins-slave-co7 (i-00824bebc16a60c37) in /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master
[e] { (hide)
[Pipecho (hide)
applying default log parsing rules
[PipelineFile (hide)
[Pipstep (hide)
[P] sh (hide)
+ rm /var/lib/jenkins/workspace/IndustryPlatforms_listhub_master/parsing.rules
[Pipeline] }
[Pipeline] // node
[Pipeline] End of Pipeline

GitHub has been notified of this commitâ€™s build result

ERROR: script returned exit code 22
Finishe
 Help us localize this pagePage generated: Jan 6, 2021 2:07:34 PM UTCREST APIJenkins ver. 2.176.2